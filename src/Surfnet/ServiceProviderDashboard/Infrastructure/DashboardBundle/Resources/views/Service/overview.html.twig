{% extends '::base.html.twig' %}

{% block body_container %}
    {# todo: ensure this no longer is an array of services #}
    {% for service in services %}
        <h1>{% block page_heading %}{{ 'service.overview.title'|trans({'%name%': service.name }) }}{% endblock %}</h1>

        <div class="fieldset card action">
            <ul>
                {% if service.arePrivacyQuestionsEnabled %}
                <li>
                    <a href="{{ path('privacy_questions', {'serviceId': service.id}) }}">
                        <i class="fa fa-key" aria-hidden="true"></i>
                        {{ 'service.overview.action.privacyQuestions'|trans }}
                    </a>
                </li>
                {% endif %}

                {% if isAdmin %}
                <li>
                    <a href="{{ path('service_edit', {'serviceId': service.id}) }}">
                        <i class="fa fa-pencil-square" aria-hidden="true"></i>
                        {{ 'service.overview.action.serviceEdit'|trans }}
                    </a>
                </li>
                <li>
                    <a href="{{ path('service_delete', {'serviceId': service.id}) }}">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                        {{ 'service.overview.action.serviceDelete'|trans }}
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>

        <div class="fieldset card">
            <div class="service-status-container">
                <div class="service-status-title">
                    <a href="{{ path('entity_list', {serviceId: service.id }) }}">{{ service.name }}</a>
                </div>
                <div class="service-status-graph" data-service-id="{{ service.id }}"></div>
                <div class="service-status-entities">

                    <h2>{{ 'service.overview.entitylist.title'|trans({'%name%': service.name}) }}</h2>

                    {# Production entities #}
                    <table class="service-status-entities-table">
                        <caption>
                            <h3>{{ 'service.overview.entitylist.production.title'|trans }}</h3>
                        </caption>
                        <tr>
                            <th>{{ 'service.overview.entitylist.name'|trans }}</th>
                            <th>{{ 'service.overview.entitylist.entityId'|trans }}</th>
                            <th>{{ 'entity.list.primary_contact'|trans }}</th>
                            <th>{{ 'service.overview.entitylist.protocol'|trans }}</th>
                            <th>{{ 'service.overview.entitylist.state'|trans }}</th>
                            <th>{{ ''|trans }}</th>
                        </tr>
                        {% set hasEntities = false %}
                        {% for entity in service.entityList %}
                            {% if entity.environment == 'production' %}
                                {% set hasEntities = true %}
                                <tr>
                                    <td><a href="{{ entity.link }}">{{ entity.name }}</a></td>
                                    <td>{{ entity.entityId }}</td>
                                    <td>{{ entity.contact }}</td>
                                    <td>{{ entity.protocol }}</td>
                                    <td>{{ entity.state }}</td>
                                    <td class="actions">
                                        <div tabindex="0">
                                            <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                            <i class="fa fa-caret-down" aria-hidden="true"></i>

                                            {% include '@Dashboard/EntityActions/actionsForList.html.twig' with {entity: entity.actions} %}
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        {% if hasEntities == false %}
                            <tr>
                                <td colspan="4">{{ 'service.overview.entitylist.empty'|trans }}</td>
                            </tr>
                        {% endif %}
                    </table>

                    {# Test entities #}
                    <table class="service-status-entities-table">
                        <caption>
                            <h3>{{ 'service.overview.entitylist.test.title'|trans }}</h3>
                        </caption>
                        <tr>
                            <th>{{ 'service.overview.entitylist.name'|trans }}</th>
                            <th>{{ 'service.overview.entitylist.entityId'|trans }}</th>
                            <th>{{ 'entity.list.primary_contact'|trans }}</th>
                            <th>{{ 'service.overview.entitylist.protocol'|trans }}</th>
                            <th>{{ 'service.overview.entitylist.state'|trans }}</th>
                            <th>{{ ''|trans }}</th>
                        </tr>
                        {% set hasEntities = false %}
                        {% for entity in service.entityList %}
                            {% if entity.environment == 'test' %}
                                {% set hasEntities = true %}
                                <tr>
                                    <td><a href="{{ entity.link }}">{{ entity.name }}</a></td>
                                    <td>{{ entity.entityId }}</td>
                                    <td>{{ entity.contact }}</td>
                                    <td>{{ entity.protocol }}</td>
                                    <td>{{ entity.state }}</td>
                                    <td class="actions">
                                        <div tabindex="0">
                                            <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
                                            <i class="fa fa-caret-down" aria-hidden="true"></i>

                                            {% include '@Dashboard/EntityActions/actionsForList.html.twig' with {entity: entity.actions} %}
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        {% if hasEntities == false %}
                            <tr>
                                <td colspan="4">{{ 'service.overview.entitylist.empty'|trans }}</td>
                            </tr>
                        {% endif %}
                    </table>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}
